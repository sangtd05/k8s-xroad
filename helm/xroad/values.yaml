---
# Default values for xroad.

# Global configuration
global:
  # Instance identifier for X-Road
  instanceIdentifier: "EE"
  # Namespace for all components
  namespace: "xroad"

# Central Server configuration
centralServer:
  enabled: true
  image:
    repository: xroad-centralserver
    tag: "7.6.0"
    pullPolicy: Always
  
  # Central server ports
  ports:
    admin: 4000
    management: 4001
    registration: 4002
    postgres: 5432
  
  # Service configuration
  service:
    type: NodePort
    adminNodePort: 30060
    managementNodePort: 30061
    registrationNodePort: 30062
  
  # Resources
  resources:
    limits:
      cpu: 2000m
      memory: 4000Mi
    requests:
      cpu: 500m
      memory: 2000Mi
  
  # Persistence
  persistence:
    enabled: true
    storageClass: ""
    size: 10Gi
  
  # Node selector for Central Server
  nodeSelector: {}
  # nodeSelector:
  #   kubernetes.io/hostname: k8s-worker-1
  
  # Environment variables
  env:
    tokenPIN: ""
    adminUser: "xrd-sys"
    adminPassword: "secret"

# Security Server cluster configuration
securityServer:
  enabled: true
  image:
    repository: niis/xroad-security-server-sidecar
    primaryTag: "7.6.1-primary-ee"
    secondaryTag: "7.6.1-secondary-ee"
    pullPolicy: Always
  
  # Number of secondary servers
  secondaryReplicaCount: 2
  
  # Service configuration
  service:
    type: NodePort
    adminNodePort: 30050
    consumerNodePort: 30051
    transportNodePort: 30052
    ocspNodePort: 30053
    healthNodePort: 30054
  
  # Resources
  resources:
    limits:
      cpu: 2000m
      memory: 4000Mi
    requests:
      cpu: 500m
      memory: 2000Mi
  
  # Persistence
  persistence:
    etcVolumeSize: 100Mi
    libVolumeSize: 1000Mi
  
  # Node selector for Security Server
  nodeSelector: {}
  # nodeSelector:
  #   kubernetes.io/hostname: k8s-worker-2

# PostgreSQL Operator configuration (installed separately)
postgresOperator:
  enabled: false  # Disabled - install separately

postgresOperatorUI:
  enabled: false  # Disabled - install separately

# PostgreSQL cluster configuration (disabled - using external HA cluster)
postgresql:
  enabled: false  # Disabled - using external PostgreSQL HA cluster

# External database configuration for X-Road
externalDatabase:
  enabled: true
  host: "xroad-postgres-ha.xroad.svc.cluster.local"
  port: 5432
  database: "xroad"
  username: "xroad"
  password: "xroad123"  # Will be overridden by operator-created secret
  sslMode: "prefer"
  
  # Connection pool settings
  maxConnections: 100
  connectionTimeout: 30
  idleTimeout: 300
  
  # Replica service for read-only operations (optional)
  replicaHost: "xroad-postgres-ha-repl.xroad.svc.cluster.local"
  replicaPort: 5432

# Network policies
networkPolicy:
  enabled: false
  adminAllowedIPRange: "0.0.0.0/0"

# Secrets configuration
secrets:
  # Environment secret for X-Road
  envSecretName: ""
  envSecret:
    tokenPIN: ""
    adminUserName: "xrd-sys"
    adminUserPassword: "secret"
  
  # SSH secret for configuration replication
  sshSecretName: ""
  sshSecret:
    privateKey: ""
    publicKey: ""

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: xroad.example.com
      paths:
        - path: /
          pathType: Prefix
          service:
            name: central-server
            port: 4000
  tls: []

# Pod Anti-Affinity for High Availability
podAntiAffinity:
  enabled: true
  type: "preferredDuringSchedulingIgnoredDuringExecution"

# Monitoring configuration
monitoring:
  enabled: false
  # Prometheus service monitor
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s
